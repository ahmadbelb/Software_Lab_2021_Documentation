<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Caching &mdash; Cylinder  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced I/O Use Cases" href="ioformats.html" />
    <link rel="prev" title="Multi-channel" href="multichannel.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
            <a href="index.html">
            <img src="_static/BMW.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced topics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="multichannel.html">Multi-channel</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Caching</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#enabling-the-cache">Enabling the cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cache-configuration">Cache configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cache-levels">Cache levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ioformats.html">Advanced I/O Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="recordings.html">Example files</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cylinder</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Caching</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/cache.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="caching">
<h1>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h1>
<p>This section covers the <em>librosa</em> function cache.  This allows you
to store and re-use intermediate computations across sessions.</p>
<div class="section" id="enabling-the-cache">
<h2>Enabling the cache<a class="headerlink" href="#enabling-the-cache" title="Permalink to this headline">¶</a></h2>
<p>By default, caching is disabled.  To enable caching, the environment
variable <cite>LIBROSA_CACHE_DIR</cite> must be set prior to loading <em>librosa</em>.
This can be done on the command line prior to instantiating a python interpreter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export LIBROSA_CACHE_DIR=/tmp/librosa_cache
$ ipython
</pre></div>
</div>
<p>or from within python, prior to importing <em>librosa</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LIBROSA_CACHE_DIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/tmp/librosa_cache&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">librosa</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The cache does not implement any eviction policy.  As such,
it can grow without bound on disk if not purged.
To purge the cache directly, call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">librosa</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cache-configuration">
<h2>Cache configuration<a class="headerlink" href="#cache-configuration" title="Permalink to this headline">¶</a></h2>
<p>The cache is implemented on top of <a class="reference external" href="https://pythonhosted.org/joblib/memory.html">joblib.Memory</a>.
The default configuration can be overridden by setting the following environment variables</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>LIBROSA_CACHE_DIR</cite> : path (on disk) to the cache directory</p></li>
<li><p><cite>LIBROSA_CACHE_MMAP</cite> : optional memory mapping mode <cite>{None, ‘r+’, ‘r’, ‘w+’, ‘c’}</cite></p></li>
<li><p><cite>LIBROSA_CACHE_COMPRESS</cite> : flag to enable compression of data on disk <cite>{0, 1}</cite></p></li>
<li><p><cite>LIBROSA_CACHE_VERBOSE</cite> : controls how much debug info is displayed. <cite>{int, non-negative}</cite></p></li>
<li><p><cite>LIBROSA_CACHE_LEVEL</cite> : controls the caching level: the larger this value, the more data is cached. <cite>{int}</cite></p></li>
</ul>
</div></blockquote>
<p>Please refer to the <cite>joblib.Memory</cite> <a class="reference external" href="https://pythonhosted.org/joblib/memory.html#memory-reference">documentation</a> for a detailed explanation of these
parameters.</p>
<p>As of 0.7, librosa’s cache wraps (rather than extends) the <cite>joblib.Memory</cite> object.
The memory object can be directly accessed by <cite>librosa.cache.memory</cite>.</p>
</div>
<div class="section" id="cache-levels">
<h2>Cache levels<a class="headerlink" href="#cache-levels" title="Permalink to this headline">¶</a></h2>
<p>Cache levels operate in a fashion similar to logging levels.
For small values of <cite>LIBROSA_CACHE_LEVEL</cite>, only the most important (frequently used) data are cached.
As the cache level increases, broader classes of functions are cached.
As a result, application code may run faster at the expense of larger disk usage.</p>
<p>The caching levels are described as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>10: filter bases, independent of audio data (mel, chroma, constant-q)</p></li>
<li><p>20: low-level features (cqt, stft, zero-crossings, etc)</p></li>
<li><p>30: high-level features (tempo, beats, decomposition, recurrence, etc)</p></li>
<li><p>40: post-processing (delta, stack_memory, normalize, sync)</p></li>
</ul>
</div></blockquote>
<p>The default cache level is 10.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>To demonstrate how to use the cache, we’ll first call an example script twice without caching:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ time -p ./estimate_tuning.py Kevin_MacLeod_-_Vibe_Ace.ogg
Loading  Kevin_MacLeod_-_Vibe_Ace.ogg
Separating harmonic component ...
Estimating tuning ...
+9.00 cents
real 6.74
user 6.03
sys 1.09

$ time -p ./estimate_tuning.py Kevin_MacLeod_-_Vibe_Ace.ogg
Loading  Kevin_MacLeod_-_Vibe_Ace.ogg
Separating harmonic component ...
Estimating tuning ...
+9.00 cents
real 6.68
user 6.04
sys 1.05
</pre></div>
</div>
<p>Next, we’ll enable caching to <cite>/tmp/librosa</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export LIBROSA_CACHE_DIR=/tmp/librosa
</pre></div>
</div>
<p>and set the cache level to 50:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export LIBROSA_CACHE_LEVEL=50
</pre></div>
</div>
<p>And now we’ll re-run the example script twice.  The first time, there will be no cached values, so the time
should be similar to running without cache.  The second time, we’ll be able to reuse intermediate values, so
it should be significantly faster.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ time -p ./estimate_tuning.py Kevin_MacLeod_-_Vibe_Ace.ogg
Loading  Kevin_MacLeod_-_Vibe_Ace.ogg
Separating harmonic component ...
Estimating tuning ...
+9.00 cents
real 7.60
user 6.79
sys 1.15

$ time -p ./estimate_tuning.py Kevin_MacLeod_-_Vibe_Ace.ogg
Loading  Kevin_MacLeod_-_Vibe_Ace.ogg
Separating harmonic component ...
Estimating tuning ...
+9.00 cents
real 1.64
user 1.30
sys 0.74
</pre></div>
</div>
<p>Reducing the cache level to 20 yields an intermediate acceleration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export LIBROSA_CACHE_LEVEL=20

$ time -p ./estimate_tuning.py Kevin_MacLeod_-_Vibe_Ace.ogg
Loading  Kevin_MacLeod_-_Vibe_Ace.ogg
Separating harmonic component ...
Estimating tuning ...
+9.00 cents
real 4.98
user 4.17
sys 1.22
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="multichannel.html" class="btn btn-neutral float-left" title="Multi-channel" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ioformats.html" class="btn btn-neutral float-right" title="Advanced I/O Use Cases" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Ahmad M. Belbeisi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-171031946-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-171031946-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>